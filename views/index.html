<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Black Dome of Death</title>
    <script>
      const playerId = Math.floor(Math.random() * Date.now())
      function send(message, type) {
        const data = {
          message,
          timestamp: Date.now(),
          playerId,
          type
        }
        ws.send(JSON.stringify(data));
        document.getElementById("message").value = "";
        
        const ul = document.getElementById("messages") ;
        const li = document.createElement("li");
        li.innerText = `Me: ${message}`;
        ul.appendChild(li);
      }
      
      function onSubmitText(e) {
        e.preventDefault();
        send(document.getElementById("message").value, "message");
      }
      
      function setUpOptions(options) {
        const div = document.getElementById("options");
        options.forEach((option) => {
          const button = document.createElement("button");
          button.innerText = option.name;
          button.value = option.id;
          div.appendChild(button);
        });
      }

      const ws = new WebSocket(`wss://${window.location.host}`);
      ws.onopen = () => {
        console.log("Connected to server");
        document.getElementById("status").innerText = "Status: Connected";
        send("Hello Bun, I'm a player!")
      };
      
      ws.onmessage = (message) => {
        const data = JSON.parse(message.data);
        console.log("Received message:", message, data);
        const ul = document.querySelector("ul");
        const li = document.createElement("li");
        li.innerText = `Remote: ${data.message}`;
        ul.appendChild(li);
      };
      
      ws.onclose = () => {
        console.log("Disconnected from server");
        document.getElementById("status").innerText = "Status: Disconnected";
      };
      ws.onerror = (error) => {
        console.error("Error:", error);
        document.getElementById("status").innerText = "Status: Error";
      };
    </script>
  </head>

  <body>
    <h3 id="status">Status: Unknown</h3>
  <ul id="messages">
<!--  Messages go here  -->
  </ul>
    <form onsubmit="onSubmitText(event)">
    <input id="message" type="text" />
    <button onclick="onSubmitText(event)" type="submit" onsubmit="onSubmitText(event)">Send</button>
    </form>
    <h1>Welcome to the Black Dome of Death!</h1>
    <p>This game is nowhere near functional yet.</p>

  <button onclick='send("poll", "message")'></button>
  <div id='options'>
    <!-- Buttons for polls will be auto generated here -->
  </div>
  </body>
</html>
